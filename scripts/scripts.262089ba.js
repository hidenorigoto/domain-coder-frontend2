function inherits(a,b){a.super_=b,a.prototype=Object.create(b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}!function(exports){"use strict";var module=angular.module("ConceptualForm.Core",[]).config(function(){}),ConceptualForm=exports.ConceptualForm||{};!function(Core){Core.Matrix=function(a,b){this.rows=a,this.cols=b,this.data=new Array(a*b),this.initializeAll()},Core.Matrix.prototype.rowColToIndex=function(a,b){return a*this.cols+b},Core.Matrix.prototype.initializeAll=function(){var a=this;this.data=_.map(this.data,function(b){return a.initialize(b)})},Core.Matrix.prototype.initialize=function(){return 0},Core.Matrix.prototype.get=function(a,b){return this.data[this.rowColToIndex(a,b)]},Core.Matrix.prototype.set=function(a,b,c){this.data[this.rowColToIndex(a,b)]=c},Core.Matrix.prototype.isZero=function(){},Object.defineProperty(Core.Matrix.prototype,"isZero",{get:function(){return _.reduce(this.data,function(a,b){return a&&b.isZero},!0)}}),Core.TypedMatrix=function(a,b,c){this.className=c,Core.Matrix.call(this,a,b)},inherits(Core.TypedMatrix,Core.Matrix),Core.TypedMatrix.prototype.initialize=function(){return eval("new "+this.className+"()")},Core.Direction=function(){this.isZero=!0,this.from=null,this.fromMany=!1,this.to=null,this.toMany=!1,this.reverse=null},Core.Direction.prototype.createReverse=function(){var a=new Core.Direction;return a.isZero=this.isZero,a.from=this.to,a.fromMany=this.toMany,a.to=this.from,a.toMany=this.fromMany,a.reverse=this,this.reverse=a,a},Core.Direction.prototype.toString=function(){if(this.isZero)return"0";var a="ー";return this.toMany&&this.fromMany&&(a="←→"),this.toMany&&(a="→"),this.fromMany&&(a="←"),this.from.name+a+this.to.name},Core.PathWalkMatrix=function(a){this.entities=a,Core.TypedMatrix.call(this,a.length,a.length,"ConceptualForm.Core.Direction")},inherits(Core.PathWalkMatrix,Core.TypedMatrix),Core.PathWalkMatrix.prototype.entityToIndex=function(a){return _.findIndex(this.entities,function(b){return b.equals(a)})},Core.PathWalkMatrix.prototype.getByEntity=function(a,b){var c=this.entityToIndex(a),d=this.entityToIndex(b);return this.get(c,d)},Core.PathWalkMatrix.prototype.directionsByEntity=function(a){var b,c,d=this.entityToIndex(a),e=[];for(b=0;b<this.rows;b++)c=this.get(d,b),c.isZero||e.push(c);return e},Core.PathWalker=function(a){this.matrix=angular.copy(a),this.error=!1,this.errorMessage="",this.formViews=[],this.checkedEntities=[]},Core.PathWalker.prototype.generateFormViews=function(a){var b=new Core.FormView;return this.checkedEntities=[],this.formViews=[b],this._generateFormViews(a,b),this.matrix.isZero||(this.error=!0,this.errorMessage="divided"),this.error},Core.PathWalker.prototype._generateFormViews=function(a,b){if(!this.error){if(angular.isDefined(_.find(this.checkedEntities,function(b){return b.equals(a)})))return this.error=!0,void(this.errorMessage="loop");var c,d,e=this;b.entities.push(a),this.checkedEntities.push(a),c=this.matrix.directionsByEntity(a),_.map(c,function(a){a.isZero||(a.isZero=!0,a.reverse.isZero||(a.toMany?(b.childDirections.push(a),d=new Core.FormView,d.parentDirection=a.reverse,e.formViews.push(d),e._generateFormViews(a.to,d)):e._generateFormViews(a.to,b)))})}},Core.FormView=function(){this.parentDirection=null,this.entities=[],this.childDirections=[]},Core.FormView.prototype.toString=function(){var a="";return null!==this.parentDirection&&(a+="ある"+this.parentDirection.to.name+"に属する"),a+=_.reduce(this.entities,function(a,b){return""!=a&&(a+="・"),a+b.name},"")+"のリスト"}}(ConceptualForm.Core=ConceptualForm.Core||{}),exports.ConceptualForm=ConceptualForm}(this),function(a){"use strict";var b=(angular.module("ConceptualForm.Mapper",[]).config(function(){}),a.ConceptualForm||{});!function(a){a.DomainCoder=function(){},a.DomainCoder.prototype.entitiesToMatrix=function(a){var c,d,e,f=(a.length,new b.Core.PathWalkMatrix(a)),g=this;return _.map(a,function(a){_.map(a.relations,function(a){c=f.entityToIndex(a.targets[0].entityObject),d=f.entityToIndex(a.targets[1].entityObject),c>=0&&d>=0&&(e=g.relationToDirection(a),f.set(c,d,e),f.set(d,c,e.createReverse()))})}),f},a.DomainCoder.prototype.relationToDirection=function(a){var c=new b.Core.Direction;c.isZero=!1;var d=a.targets;return c.from=d[0].entityObject,c.fromMany=d[0].cardinalityObject.isMany,c.to=d[1].entityObject,c.toMany=d[1].cardinalityObject.isMany,c}}(b.Mapper=b.Mapper||{}),a.ConceptualForm=b}(this),function(a){"use strict";var b=angular.module("DomainCoder.Core",[]).config(function(){});b.run(["$rootScope","$state","$log","dcore_ContextFactory",function(a,b,c,d){a.$on("context.add.request",function(){var c=d.create();a.$broadcast("context.add.after",c),b.go("context",{contextId:c.id})})}]);var c=a.DomainCoder||{};c.Model=c.Model||{},function(a){a.Context=function(a,b){this.id=a,this.name=b,this.description="",this.refs={entity:[]},this.diagrams={entity:[]}},a.Context.prototype.equals=function(a){return this.id===a.id},a.Context.prototype.registerEntity=function(a){this.refs.entity.push(a)},a.Context.prototype.hasEntity=function(a){return void 0===a?!1:null===a?!1:angular.isDefined(_.find(this.refs.entity,{id:a.id}))},a.ContextFactory=function(a,b){this._uuid4=a,this._ContextCollection=b},a.ContextFactory.prototype.create=function(a){angular.isDefined(a)||(a="新規コンテキスト");var b=new c.Core.Context(this._uuid4.generate(),a);return this._ContextCollection.push(b),b},a.ContextCollection=function(){},a.ContextCollection.prototype=new Array,a.ContextCollection.prototype.get=function(a){return _.find(this,{id:a})}}(c.Core=c.Core||{}),b.factory("dcore_ContextFactory",["uuid4","dcore_ContextCollection",function(a,b){return new c.Core.ContextFactory(a,b)}]),b.factory("dcore_ContextCollection",function(){return new c.Core.ContextCollection}),a.DomainCoder=c}(this),function(a){"use strict";var b=angular.module("DomainCoder.ng.ContextEditor",["DomainCoder.Core","DomainCoder.ng.ui"]).config(function(){}),c=a.DomainCoder||{};!function(a){a.Context=function(a,b,c,d){this.ContextCollection=a,this.$state=b,this.$stateParams=c,this.$log=d},a.Context.prototype.initialize=function(){this.current=this.ContextCollection.get(this.$stateParams.contextId),angular.isDefined(this.current)||this.$state.go("home")}}(c.ContextEditor=c.ContextEditor||{}),b.factory("ContextEditor_Context",["dcore_ContextCollection","$state","$stateParams","$log",function(a,b,d,e){return new c.ContextEditor.Context(a,b,d,e)}]),b.controller("ContextEditor_MainCtrl",["$scope","$rootScope","ContextEditor_Context","$timeout","$log",function(a,b,c){c.initialize(),a.EditorContext=c,a.currentContext=c.current}]),a.DomainCoder=c}(this),function(){"use strict";var a=angular.module("DomainCoder.ng.ui",["DomainCoder.Core"]).config(function(){});a.controller("DomainCoderUiCtrl",["$scope","$rootScope","AppContext","$log",function(a){a.$on("data.new",function(){}),a.$on("field.new",function(){}),a.show=function(){}}])}(this),function(a){"use strict";var b=angular.module("DomainCoder.Model.Document",["DomainCoder.Core"]).config(function(){});b.run(["$rootScope","$state","$log","Model_Document_SectionFactory",function(a,b,c,d){a.$on("document.section.add.request",function(b,c){var e;e=angular.isDefined(c)?d.create(c.parent):d.create(),a.$apply(),a.$broadcast("document.section.add.after",e)})}]);var c=a.DomainCoder||{};c.Model=c.Model||{},function(a){a.Section=function(a,b,c){this.id=a,this.name=b,this.sortOrder=c,this.children=[]},a.Section.prototype.equals=function(a){return this.id===a.id},a.Section.prototype.appendChildSection=function(a){a.sortOrder=this.getNewSortOrder(),this.children.push(a)},a.Section.prototype.getNewSortOrder=function(){var a=_.max(this.children,function(a){return a.sortOrder});return angular.isDefined(a)?a+1:0},a.SectionFactory=function(a,b){this._uuid4=a,this._RootSection=b},a.SectionFactory.prototype.create=function(a,b){angular.isDefined(b)||(b="新規セクション"),angular.isDefined(a)||(a=this._RootSection);var d=new c.Model.Document.Section(this._uuid4.generate(),b,0);return a.appendChildSection(d),d}}(c.Model.Document=c.Model.Document||{}),b.factory("Model_Document_SectionFactory",["Model_Document_RootSection","uuid4",function(a,b){return new c.Model.Document.SectionFactory(b,a)}]),b.factory("Model_Document_RootSection",function(){return new c.Model.Document.Section("root_section","ルート",0)}),a.DomainCoder=c}(this),function(a){"use strict";var b=angular.module("DomainCoder.Model.Entity",[]).config(function(){});b.run(["$rootScope","$state","$log","emodel_EntityFactory","emodel_FieldFactory","emodel_RelationFactory",function(a,b,c,d,e,f){a.$on("entity.add.request",function(c,e){var f;angular.isDefined(e)?f=d.create(e[0],e[1]):(f=d.create(),b.go("entity",{entityId:f.id}),a.$apply()),a.$broadcast("entity.add.after",f)}),a.$on("entity.field.add.request",function(b,c){var d=e.create(c);a.$broadcast("entity.field.add.after",[d.belongTo,d])}),a.$on("entity.relation.add.request",function(b,c){var d=f.create(c,!1,null,!1);a.$broadcast("entity.relation.add.after",[d.fromEntity,d])})}]);var c=a.DomainCoder||{};c.Model=c.Model||{},function(a){a.Entity=function(a,b){this.id=a,this.name=b,this.type={},this.tableName="",this.description="",this.keys=[],this.fields=[],this.relations=[],this.relationViews=[]},a.Entity.prototype.equals=function(a){return this.id===a.id},a.Entity.prototype.addField=function(a){a.belongs=this,this.fields.push(a)},a.Entity.prototype.addRelation=function(a){angular.isDefined(_.find(this.relations,function(b){return b.equals(a)}))||(this.relations.push(a),this.updateRelationViews())},a.Entity.prototype.removeRelation=function(a){_.remove(this.relations,function(b){return b.equals(a)}),this.updateRelationViews()},a.Entity.prototype.updateRelationViews=function(){var a=this;this.relationViews=_.map(this.relations,function(b){return b.createView(a)})},a.EntityFactory=function(a,b){this._uuid4=a,this._EntityCollection=b},a.EntityFactory.prototype.create=function(a,b){angular.isDefined(a)||(a="新規エンティティ");var d=new c.Model.Entity.Entity(this._uuid4.generate(),a);return this._EntityCollection.push(d),angular.isDefined(b)&&b.registerEntity(d),d},a.EntityCollection=function(){},a.EntityCollection.prototype=new Array,a.EntityCollection.prototype.get=function(a){return _.find(this,{id:a})},a.Field=function(a,b){this.id=a,this.name=b,this.dbName="",this.programName="",this.primary=!1,this.type={},this.size=null,this.notNull=!1,this.description="",this.belongTo=null},a.Field.prototype.equals=function(a){return this.id===a.id},a.FieldFactory=function(a,b){this._uuid4=a,this._$log=b},a.FieldFactory.prototype.create=function(a,b){angular.isDefined(b)||(b="新規フィールド");var d=new c.Model.Entity.Field(this._uuid4.generate(),b);return a.fields.push(d),d.belongTo=a,d},a.Relation=function(a,b,c){this.id=a,this._relationTarget1=b,this._relationTarget2=c},a.Relation.prototype.equals=function(a){return this.id===a.id},a.Relation.prototype.valid=function(){return angular.isDefined(this._relationTarget1)&&angular.isDefined(this._relationTarget2)},a.Relation.prototype.createView=function(a){return a.equals(this._relationTarget1.entityObject)?this._createView(this._relationTarget1,this._relationTarget2):this._createView(this._relationTarget2,this._relationTarget1)},a.Relation.prototype._createView=function(a,b){return{from:a,to:b,model:this}},Object.defineProperty(a.Relation.prototype,"targets",{get:function(){return[this._relationTarget1,this._relationTarget2]}}),a.RelationFactory=function(a,b){this._uuid4=a,this._$log=b},a.RelationFactory.prototype.create=function(a,b,d,e){var f=new c.Model.Entity.RelationTarget(this._uuid4.generate(),new c.Model.Entity.Cardinality(this._uuid4.generate(),b)),g=new c.Model.Entity.RelationTarget(this._uuid4.generate(),new c.Model.Entity.Cardinality(this._uuid4.generate(),e)),h=new c.Model.Entity.Relation(this._uuid4.generate(),f,g);return f.belongsTo=h,f.entityObject=a,g.belongsTo=h,g.entityObject=d,h},a.Cardinality=function(a,b){this.id=a,this.isMany=b=!1},a.RelationTarget=function(a,b){this.id=a,this._entityObject=null,this.cardinalityObject=b,this._belongsTo=null},Object.defineProperty(a.RelationTarget.prototype,"entityObject",{get:function(){return this._entityObject},set:function(a){null!=this._entityObject&&this._entityObject.removeRelation(this._belongsTo),this._entityObject=a,angular.isDefined(a)&&null!==a&&a.addRelation(this._belongsTo)}}),Object.defineProperty(a.RelationTarget.prototype,"belongsTo",{get:function(){return this._belongsTo},set:function(a){this._belongsTo=a}})}(c.Model.Entity=c.Model.Entity||{}),b.factory("emodel_EntityFactory",["emodel_EntityCollection","uuid4",function(a,b){return new c.Model.Entity.EntityFactory(b,a)}]),b.factory("emodel_EntityCollection",function(){return new c.Model.Entity.EntityCollection}),b.factory("emodel_FieldFactory",["uuid4","$log",function(a,b){return new c.Model.Entity.FieldFactory(a,b)}]),b.factory("emodel_RelationFactory",["uuid4","$log",function(a,b){return new c.Model.Entity.RelationFactory(a,b)}]),a.DomainCoder=c}(this),function(a){"use strict";var b=angular.module("DomainCoder.ng.EntityEditor",["DomainCoder.Core","DomainCoder.Model.Entity","DomainCoder.ng.ui","ui.grid","ui.grid.selection","ui.grid.edit"]).config(function(){}),c=a.DomainCoder||{};!function(a){a.Context=function(a,b,c,d){this.EntityCollection=a,this.$state=b,this.$stateParams=c,this.$log=d},a.Context.prototype.initialize=function(){var a=this.$stateParams.entityId;this.current=null,angular.isDefined(a)&&(this.current=this.EntityCollection.get(this.$stateParams.entityId),angular.isDefined(this.current)||this.$state.go("home"))}}(c.EntityEditor=c.EntityEditor||{}),b.factory("EntityEditor_Context",["emodel_EntityCollection","$state","$stateParams","$log",function(a,b,d,e){return new c.EntityEditor.Context(a,b,d,e)}]),b.controller("EntityEditor_MainCtrl",["$scope","$rootScope","EntityEditor_Context","$timeout","$log",function(a,b,c){angular.isDefined(a.EditorContext)?c.current=a.EditorContext.selectedEntity:c.initialize(),a.current=c.current,a.entityTypes=[{type:"normal",label:""},{type:"resource",label:"リソース"},{type:"event",label:"イベント"}],a.$on("change.entity",function(b,d){c.current=d,a.current=c.current,a.$apply()}),a.$watch("current.name",function(){a.$emit("entity.update",a.current)})}]),b.controller("EntityEditor_FieldsCtrl",["$scope","$rootScope","$log",function(a){a.fields=a.current.fields,a.fieldAdd=function(){a.$emit("entity.field.add.request",a.current)},a.$watchCollection("fields",function(){a.$emit("entity.update",a.current)})}]),b.controller("EntityEditor_FieldCtrl",["$scope","$rootScope","$log",function(a){a.dataTypes=[{type:"string",label:"文字列 (string)"},{type:"int",label:"整数 (int)"},{type:"date",label:"日付 (date)"},{type:"time",label:"時刻 (time)"},{type:"datetime",label:"日時 (datetime)"},{type:"boolean",label:"真偽値 (boolean)"},{type:"decimal",label:"decimal"},{type:"smallint",label:"整数 (smallint)"},{type:"float",label:"float"},{type:"binary",label:"binary"},{type:"blob",label:"blob"}],a.$watch("field.name",function(){a.$emit("entity.update",a.current)})}]),b.controller("EntityEditor_RelationsCtrl",["$scope","$rootScope","$log",function(a){a.relationAdd=function(){a.$emit("entity.relation.add.request",a.current)}}]),b.controller("EntityEditor_RelationCtrl",["$scope","$rootScope","emodel_EntityCollection","$log",function(a,b,c){a.targetEntities=c,a.oneOrMany=[{label:"１",value:!1},{label:"多",value:!0}],a.$watch("relationView.to.entityObject",function(){a.$emit("relation.update",a.relationView)}),a.$watch("relationView.to.cardinalityObject.isMany",function(){a.$emit("relation.update",a.relationView)}),a.$watch("relationView.from.cardinalityObject.isMany",function(){a.$emit("relation.update",a.relationView)})}]),a.DomainCoder=c}(this),function(a){"use strict";var b=angular.module("DomainCoder.ng.ContextEntityEditor",["DomainCoder.Core","DomainCoder.Model.Entity","DomainCoder.ng.ui","DomainCoder.ng.ContextEditor"]).config(function(){}),c=a.DomainCoder||{};!function(a){a.Context=function(a,b,c,d){this.ContextCollection=a,this.$state=b,this.selectedEntity=null,this.$stateParams=c,this.$log=d},a.Context.prototype=c.ContextEditor.Context.prototype,a.Context.prototype.selectEntity=function(a){this.selectedEntity=a}}(c.ContextEntityEditor=c.ContextEntityEditor||{}),b.factory("ContextEntityEditor_Context",["dcore_ContextCollection","$state","$stateParams","$log",function(a,b,d,e){return new c.ContextEntityEditor.Context(a,b,d,e)}]),b.controller("EntityEditor_ContextEntityEditorCtrl",["$scope","$rootScope","ContextEntityEditor_Context","$timeout","$log","$modal",function(a,b,d,e,f,g){d.initialize(),a.EditorContext=d,a.currentContext=d.current,a.snapPaper=Snap("#context-entity-diagram"),a.diagramObjects=[],a.relationObjects=[],a.activeFlag=!1,e(function(){a.render()}),a.entityAddDialog=function(){var c=g.open({templateUrl:"views/domain-coder-entity/context-entity-add.html",controller:"EntityEditor_ContextEntityAddCtrl",scope:a});c.result.then(function(c){"string"==typeof c?b.$broadcast("entity.add.request",[c,a.currentContext]):(a.currentContext.registerEntity(c),b.$broadcast("entity.add.after",c))})},a.showEntityDetail=function(b){a.EditorContext.selectEntity(b),e(function(){a.$broadcast("change.entity",b),a.$apply()})},a.render=function(){a.currentContext.diagrams.entity.length>0&&(_.map(a.currentContext.diagrams.entity,function(b){a.addEntityToDiagram(null,b)}),_.map(a.currentContext.diagrams.relation,function(b){a.addRelationToDiagram(null,b)}))},a.addEntityToDiagram=function(b,d){var e;null!==d?(e=d,e.setPaper(a.snapPaper)):e=new c.Diagram.Entity.Entity(a.snapPaper,b),a.diagramObjects.push(e),e.render(),e.registerHover(angular.bind(this,function(){a.activeFlag=!0}),angular.bind(this,function(){})),e.registerClick(function(){}),e.registerMouseDown(function(){a.updateRelationStart()}),e.registerMouseMove(function(){a.updateRelations()}),e.registerMouseUp(function(){a.updateRelationEnd(),a.showEntityDetail(e.entityObject)})},a.addRelationToDiagram=function(b,d){var e,f;null!=d?(e=d,e.setPaper(a.snapPaper),f=d.relationObject.targets,a.relationObjects.push(e)):(e=a.findRelation(b),f=b.targets);var g=a.findEntityElement(f[0].entityObject),h=a.findEntityElement(f[1].entityObject);if(angular.isDefined(e))e.updateTarget(g,h);else{if(!angular.isDefined(g)||!angular.isDefined(h))return;a.relationObjects.push(new c.Diagram.Entity.Relation(b,g,h))}},a.findRelation=function(a){return _.find(this.relationObjects,function(b){return b.relationObject.equals(a)})},a.updateRelations=function(b){(a.update===!0||b===!0)&&_.map(a.relationObjects,function(a){a.update()})},a.updateRelationStart=function(){a.update=!0},a.updateRelationEnd=function(){a.update=!1},a.findEntityElement=function(b){return _.find(a.diagramObjects,function(a){return a.sameParent(b)})},a.$on("entity.add.after",function(b,c){a.currentContext.hasEntity(c)===!0&&a.addEntityToDiagram(c,null)}),a.$on("relation.add.after",function(b,c){var d=c[1],e=c[0];a.currentContext.hasEntity(e)===!0&&a.currentContext.hasEntity(d.toEntity)===!0&&a.addRelationToDiagram(d)}),a.$on("relation.update",function(b,c){angular.isDefined(c)&&(a.currentContext.hasEntity(c.to.entityObject)===!0&&a.currentContext.hasEntity(c.from.entityObject)===!0?a.addRelationToDiagram(c.model):a.updateRelations(!0))}),a.$on("entity.update",function(){_.map(a.diagramObjects,function(a){a.update()})}),a.$on("$destroy",function(){a.activeFlag&&(_.map(a.diagramObjects,function(a){a.saveTransform()}),a.currentContext.diagrams.entity=a.diagramObjects,_.map(a.relationObjects,function(a){a.saveTransform()}),a.currentContext.diagrams.relation=a.relationObjects)})}]),b.controller("EntityEditor_ContextEntityAddCtrl",["$scope","$modalInstance","emodel_EntityCollection",function(a,b,c){a.EntityCollection=c,a.ok=function(){b.close(a.existingEntity?a.existingEntity:a.name)},a.cancel=function(){b.dismiss("cancel")}}]),a.DomainCoder=c}(this),function(a){"use strict";var b=(angular.module("DomainCoder.Diagram.Entity",["DomainCoder.Model.Entity"]).config(function(){}),a.DomainCoder||{});b.Diagram=b.Diagram||{},function(a){a.Position=function(a,b){this.x=a,this.y=b},a.Entity=function(a,b){this.g=a,this.entityObject=b,this.group=this.g.group(),this.group.drag(),this.baseRect=null,this.transform="",this.elements=[]},a.Entity.prototype.setPaper=function(a){this.g=a,this.group=this.g.group(),this.group.drag(),this.group.transform(this.transform)},a.Entity.prototype.saveTransform=function(){this.transform=this.group.transform().string},a.Entity.prototype.update=function(){_.map(this.elements,function(a){a.remove()}),this.render()},a.Entity.prototype.render=function(){var a=this.calcHeight(),b=Snap.filter.shadow(4,4,3,"gray",.7),c=this.g.filter(b),d=this.g.rect(0,0,200,a);d.attr({fill:"#fff","fill-opacity":1,stroke:"#000",strokeWidth:1,filter:c}),this.group.add(d),this.elements.push(d);var e=this.g.text(100,17,this.entityObject.name);e.attr({textAnchor:"middle",dominantBaseline:"middle","font-family":"monospace","font-size":"16px"}),this.group.add(e),this.elements.push(e);var f=this.g.line(0,28,200,28);f.attr({stroke:"#000",strokeWidth:1}),this.group.add(f),this.elements.push(f);var g=34;this.entityObject.fields.forEach(function(a){var a=this.g.text(5,g,a.name);a.attr({textAnchor:"start",dominantBaseline:"hanging","font-family":"monospace","font-size":"12px"}),this.group.add(a),this.elements.push(a),g+=20},this);var h=this.g.rect(0,0,200,a);h.attr({fill:"#fff","fill-opacity":0,stroke:"#000",strokeWidth:0}),this.group.add(h),this.elements.push(h),this.baserect=h},a.Entity.prototype.sameParent=function(a){return this.entityObject.equals(a)},a.Entity.prototype.registerHover=function(a,b){this.baserect.hover(a,b)},a.Entity.prototype.registerClick=function(a){this.baserect.click(a)},a.Entity.prototype.registerDrag=function(a){this.group.drag(a,function(){},function(){})},a.Entity.prototype.registerMouseDown=function(a){this.group.mousedown(a)},a.Entity.prototype.registerMouseMove=function(a){this.group.mousemove(a)},a.Entity.prototype.registerMouseUp=function(a){this.group.mouseup(a)},a.Entity.prototype.calcHeight=function(){var a=this.entityObject.fields.length,b=20*a+30;return 100>b&&(b=100),b},a.Entity.prototype.getBBox=function(){return this.group.getBBox()},a.Relation=function(a,b,c){this.relationObject=a,this.g=b.g,this.updateTarget(b,c)},a.Relation.prototype.updateTarget=function(a,b){if(angular.isDefined(this.snapConnection)&&this.snapConnection.remove(),angular.isDefined(this.g)){var c=this.g.path("M0,0L10,5L0,10M10,5L0,5").attr({fill:"none",stroke:"black",strokeWidth:.5}),d=this.g.path("M10,0L0,5L10,10M00,5L100,5").attr({fill:"none",stroke:"black",strokeWidth:.5}),e=this.g.path("M0,5L10,5").attr({fill:"none",stroke:"black",strokeWidth:.5});this.markerStartMany=c.marker(0,0,10,10,10,5).attr({markerUnits:"userSpaceOnUse",markerWidth:20,markerHeight:20}),this.markerStartOne=e.marker(0,0,10,10,10,5).attr({markerUnits:"userSpaceOnUse",markerWidth:20,markerHeight:20}),this.markerEndMany=d.marker(0,0,10,10,0,5).attr({markerUnits:"userSpaceOnUse",markerWidth:20,markerHeight:20}),this.markerEndOne=e.clone().marker(0,0,10,10,0,5).attr({markerUnits:"userSpaceOnUse",markerWidth:20,markerHeight:20}),this.fromEntityElement=a,this.toEntityElement=b,this.relationObject.valid()===!0&&(this.snapConnection=this.g.connection(this.fromEntityElement,this.toEntityElement)),this.update()}},a.Relation.prototype.update=function(){this.g.connection(this.snapConnection);var a=this.relationObject.createView(this.fromEntityElement.entityObject).from.cardinalityObject.isMany,b=this.relationObject.createView(this.fromEntityElement.entityObject).to.cardinalityObject.isMany;this.snapConnection.line.attr(a===!0?{markerStart:this.markerStartMany}:{markerStart:this.markerStartOne}),this.snapConnection.line.attr(b===!0?{markerEnd:this.markerEndMany}:{markerEnd:this.markerEndOne})},a.Relation.prototype.remove=function(){this.snapConnection.line.remove()},a.Relation.prototype.setPaper=function(a){this.g=a},a.Relation.prototype.saveTransform=function(){}}(b.Diagram.Entity=b.Diagram.Entity||{}),a.DomainCoder=b}(this),function(a){"use strict";var b=angular.module("DomainCoder.ng.ConceptualFormEditor",["DomainCoder.Core","DomainCoder.Model.Entity","DomainCoder.ng.ui","DomainCoder.ng.ContextEditor","ConceptualForm.Core","ConceptualForm.Mapper"]).config(function(){}),c=a.DomainCoder||{};!function(a){a.Context=function(a,b,c,d){this.ContextCollection=a,this.$state=b,this.selectedEntity=null,this.$stateParams=c,this.$log=d},a.Context.prototype=c.ContextEditor.Context.prototype,a.Context.prototype.selectEntity=function(a){this.selectedEntity=a}}(c.ConceptualFormEditor=c.ConceptualFormEditor||{}),b.factory("ConceptualFormEditor_Context",["dcore_ContextCollection","$state","$stateParams","$log",function(a,b,d,e){return new c.ConceptualFormEditor.Context(a,b,d,e)}]),b.controller("ConceptualFormEditor_MainCtrl",["$scope","$rootScope","ConceptualFormEditor_Context","$timeout","$log","$modal",function(a,b,c){c.initialize(),a.EditorContext=c,a.currentContext=c.current;var d=new ConceptualForm.Mapper.DomainCoder;a.matrix=d.entitiesToMatrix(c.current.refs.entity)}]),b.controller("ConceptualFormEditor_SubFormsCtrl",["$scope","$rootScope","$log",function(a,b,c){var d=new ConceptualForm.Core.PathWalker(a.matrix);a.error=d.generateFormViews(a.entity),a.errorMessage=d.errorMessage,a.formViews=d.formViews,c.info(a.formViews)}]),a.DomainCoder=c}(this),function(){"use strict";var a=angular.module("DomainCoder.App.Main",["DomainCoder.Core"]).config(function(){}),b=function(a,b,c){this.$location=a,this.$route=b,this.$log=c,this.setting={url:""},this.targetContext=null,this.targetConcept=null,this.targetEntity=null};b.prototype={goHome:function(){this.$location.path("/")},toBreadCrumb:function(){if(this.isData()){var a="データ > "+this.targetData.name;return""!==this.targetData.tableName&&(a+=" ("+this.targetData.tableName+")"),a}return"トップ"},changeByUrl:function(a){angular.isDefined(this.$route.current)&&angular.isDefined(this.$route.current.params.dataId)&&(this.targetData=_.find(DataCollection,{id:this.$route.current.params.dataId}),angular.isDefined(a)&&a.$broadcast("data.select.after",this.targetData))},selectEntity:function(a){this.$location.path("entity/"+a.id)}},a.factory("AppContext",["$location","$route","$log",function(a,c,d){return new b(a,c,d)}]),a.controller("MainCtrl",["$rootScope","$scope","AppContext","$injector",function(a,b,c,d){d.get("$controller");b.$on("data.select",function(a,b){c.selectData(b)})}])}(this),function(){"use strict";var a=angular.module("DomainCoder.App.Menu",["DomainCoder.ng.ui","DomainCoder.Model.Document"]).config(function(){});a.controller("TopNavCtrl",["$scope","$log",function(a){a.toggleLeftMenu=function(){},a.showSetting=angular.bind(this,function(){}),a.showMenu=function(){}}]),a.controller("LeftMenuCtrl",["$scope","$rootScope","$log",function(){}]),a.controller("LeftMenuContextCtrl",["$scope","$rootScope","dcore_ContextCollection","$log",function(a,b,c){a.ContextCollection=c}]),a.controller("LeftMenuEntityCtrl",["$scope","$rootScope","emodel_EntityCollection","$log",function(a,b,c){a.EntityCollection=c}]),a.controller("LeftMenuDocumentCtrl",["$scope","$rootScope","Model_Document_RootSection","$log",function(a,b,c){a.RootSection=c}])}(this),function(){"use strict";var a=angular.module("phpmentors.directives",[]).config(function(){});a.directive("focusOn",["$timeout","$log",function(a){return{restrict:"A",link:function(b,c,d){b.$on(d.focusOn,function(){a(function(){c.focus()})})}}}]),a.directive("raiseEvent",["$rootScope","$timeout","$log",function(a){return{restrict:"A",scope:{name:"@raiseEvent",argument:"=eventArg"},link:function(b,c){c.on("click",function(){a.$broadcast(b.name,b.argument)})}}}])}(this),Snap.plugin(function(a,b,c){c.prototype.connection=function(a,b,c,d){a.line&&a.from&&a.to&&(c=a,a=c.from,b=c.to);var e=a.getBBox(),f=b.getBBox();e.x-=20,e.y-=20,e.width+=40,e.height+=40,f.x-=20,f.y-=20,f.width+=40,f.height+=40;for(var g=[{x:e.x+e.width/2,y:e.y-1},{x:e.x+e.width/2,y:e.y+e.height+1},{x:e.x-1,y:e.y+e.height/2},{x:e.x+e.width+1,y:e.y+e.height/2},{x:f.x+f.width/2,y:f.y-1},{x:f.x+f.width/2,y:f.y+f.height+1},{x:f.x-1,y:f.y+f.height/2},{x:f.x+f.width+1,y:f.y+f.height/2}],h={},i=[],j=0;4>j;j++)for(var k=4;8>k;k++){var l=Math.abs(g[j].x-g[k].x),m=Math.abs(g[j].y-g[k].y);(j==k-4||(3!=j&&6!=k||g[j].x<g[k].x)&&(2!=j&&7!=k||g[j].x>g[k].x)&&(0!=j&&5!=k||g[j].y>g[k].y)&&(1!=j&&4!=k||g[j].y<g[k].y))&&(i.push(l+m),h[i[i.length-1]]=[j,k])}if(0==i.length)var n=[0,4];else n=h[Math.min.apply(Math,i)];var o=g[n[0]].x,p=g[n[0]].y,q=g[n[1]].x,r=g[n[1]].y;l=Math.max(Math.abs(o-q)/2,10),m=Math.max(Math.abs(p-r)/2,10);var s=[o,o,o-l,o+l][n[0]].toFixed(3),t=[p-m,p+m,p,p][n[0]].toFixed(3),u=[0,0,0,0,q,q,q-l,q+l][n[1]].toFixed(3),v=[0,0,0,0,p+m,p-m,r,r][n[1]].toFixed(3),w="M"+o.toFixed(3)+","+p.toFixed(3)+"C"+[s,t,u,v,q.toFixed(3),r.toFixed(3)].join();if(!c||!c.line){var x="string"==typeof c?c:"black";return{bg:d&&d.split&&this.path(w).attr({stroke:d.split("|")[0],fill:"none","stroke-width":d.split("|")[1]||3}),line:this.path(w).attr({stroke:x,fill:"none"}),from:a,to:b,remove:function(){this.line.remove()}}}c.bg&&c.bg.attr({path:w}),c.line.attr({path:w})}}),function(){"use strict";var a=angular.module("DomainCoder.App",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.router","ui.grid","ui.grid.selection","ui.grid.edit","ui.bootstrap","ui.tree","DomainCoder.Core","DomainCoder.ng.ui","DomainCoder.App.Main","DomainCoder.App.Menu","DomainCoder.ng.ContextEditor","DomainCoder.Model.Entity","DomainCoder.ng.EntityEditor","DomainCoder.ng.ContextEntityEditor","ConceptualForm.Core","ConceptualForm.Mapper","DomainCoder.ng.ConceptualFormEditor","DomainCoder.Model.Document","uuid4","phpmentors.directives"]);a.run(["$log","$rootScope","$state","AppContext",function(a,b,c,d){b.AppContext=d}]),a.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("home",{url:"/",templateUrl:"views/app/start.html"}).state("context",{url:"/context/{contextId}",templateUrl:"views/domain-coder/context-editor.html",controller:"ContextEditor_MainCtrl"}).state("context-entity",{url:"/context/{contextId}/entity",templateUrl:"views/domain-coder-entity/context-entity-editor.html",controller:"EntityEditor_ContextEntityEditorCtrl"}).state("entity",{url:"/entity/{entityId}",templateUrl:"views/domain-coder-entity/entity-editor.html",controller:"EntityEditor_MainCtrl"}).state("context-conceptual-form",{url:"/context/{contextId}/conceptual-form",templateUrl:"views/domain-coder-conceptual-form/editor.html",controller:"ConceptualFormEditor_MainCtrl"})}])}();